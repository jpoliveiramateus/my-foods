'use strict';

var isReactReduxConnect = require('../isReactReduxConnect');

var report = function report(context, node) {
  context.report({
    message: 'Connected component should be defined in a separate file.',
    node
  });
};

module.exports = function (context) {
  return {
    CallExpression(node) {
      if (isReactReduxConnect(node)) {
        var component = node.parent && node.parent.arguments && node.parent.arguments[0];
        if (component) {
          var vars = context.getScope().variables;
          vars.forEach(function (definedVar) {
            if (component.name === definedVar.name) {
              definedVar.defs.forEach(function (def) {
                if (!(def.type === 'ImportBinding' || context.getSource(def.node).includes('require'))) {
                  report(context, component);
                }
              });
            }
          });
        }
      }
    }
  };
};